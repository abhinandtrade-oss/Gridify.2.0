<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Events - Admin Dashboard</title>
    <link rel="icon" href="../assets/images/favicon.png" type="image/png">
    <link rel="stylesheet" href="../assets/css/style.css">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script src="../assets/js/firebase-config.js"></script>
    <script src="../assets/js/auth.js"></script>
    <script src="../assets/js/db.js"></script>
    <script type="module">
        import { formatDate } from '../assets/js/utils.js';
        window.formatDate = formatDate;
    </script>
</head>

<body>

    <div class="main-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div style="text-align: center; margin-bottom: 1rem;">
                <img src="../assets/images/logo.png" alt="SSV" style="height: 150px;">
            </div>
            <h2 style="color: var(--secondary-color); margin-bottom: 0.2rem; text-align: center;">Event Tracker Admin
            </h2>
            <div class="sidebar-brand-sub"
                style="text-align: center; color: var(--text-secondary); font-size: 0.8rem; margin-bottom: 0.5rem;">by
                Gridify</div>
            <p style="font-size: 0.75rem; color: var(--text-secondary); text-align: center; margin-bottom: 2rem;">
                dedicated portal for Jobins KJ</p>

            <nav style="display: flex; flex-direction: column; gap: 1rem;">
                <a href="dashboard.html" class="btn btn-primary"
                    style="justify-content: flex-start; background: transparent; border: 1px solid var(--border-color);">
                    Dashboard
                </a>
                <a href="events.html" class="btn btn-primary"
                    style="justify-content: flex-start; background: rgba(255,255,255,0.1); border:none;">
                    Events
                </a>
                <a href="staff-data.html" class="btn btn-primary"
                    style="justify-content: flex-start; background: transparent; border: 1px solid var(--border-color);">
                    Update Staff Data
                </a>
                <a href="reports.html" class="btn btn-primary"
                    style="justify-content: flex-start; background: transparent; border: 1px solid var(--border-color);">
                    Reports
                </a>
                <a href="../user/dashboard.html" class="btn btn-primary"
                    style="justify-content: flex-start; background: transparent; border: 1px solid var(--border-color);">
                    User View
                </a>
            </nav>

            <div style="margin-top: auto;">
                <button onclick="AuthService.logout()" class="btn btn-danger" style="width: 100%;">Logout</button>
            </div>
        </aside>

        <!-- Content -->
        <main class="content-area">
            <header class="flex justify-between items-center mb-4">
                <h1>All Events</h1>
                <span class="status-badge status-urgent">Admin Access</span>
            </header>

            <div class="card animate-fade-in">
                <table style="width: 100%; border-collapse: collapse; text-align: left;">
                    <thead>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <th style="padding: 1rem;">Event Name</th>
                            <th style="padding: 1rem;">Date</th>
                            <th style="padding: 1rem;">Coordinator</th>
                            <th style="padding: 1rem;">Department</th>
                            <th style="padding: 1rem;">Status</th>
                            <th style="padding: 1rem;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="eventTableBody">
                        <tr>
                            <td colspan="6" style="padding: 1rem; text-align: center;">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Alert Modal -->
    <div id="customAlert" class="modal-overlay">
        <div class="modal-content" style="text-align:center;">
            <h3 id="alertTitle">Alert</h3>
            <p id="alertMessage" style="margin-bottom: 1rem; color: var(--text-secondary);"></p>
            <button onclick="document.getElementById('customAlert').classList.remove('active')"
                class="btn btn-primary">OK</button>
        </div>
    </div>

    <script type="module">
        import { formatDate } from '../assets/js/utils.js';
        window.formatDate = formatDate; // Make available globally

        AuthService.requireRole('admin');

        async function loadEvents() {
            const events = await DBService.getEvents();
            const tbody = document.getElementById('eventTableBody');
            tbody.innerHTML = '';

            if (events.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="padding: 1rem; text-align: center;">No events found.</td></tr>';
                return;
            }

            events.forEach(event => {
                let statusClass = 'status-pending';
                if (event.status === 'Report Received') statusClass = 'status-received';
                if (event.status === 'Completed') statusClass = 'status-received';
                if (event.status === 'Under Review') statusClass = 'status-info';
                if (event.status === 'Changes Requested') statusClass = 'status-urgent';

                const tr = document.createElement('tr');
                tr.style.borderBottom = '1px solid var(--border-color)';
                tr.innerHTML = `
                    <td style="padding: 1rem;">${event.eventName}</td>
                    <td style="padding: 1rem;">${formatDate(event.eventDate)}</td>
                    <td style="padding: 1rem;">${event.coordinatorName}</td>
                    <td style="padding: 1rem;">${event.department || '-'}</td>
                    <td style="padding: 1rem;"><span class="status-badge ${statusClass}">${event.status}</span></td>
                    <td style="padding: 1rem;">
                        <a href="../user/event-detail.html?id=${event.id}" class="btn btn-primary" style="padding:0.25rem 0.5rem; text-decoration:none;">View</a>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        loadEvents();
    </script>
</body>

</html>